## 第2章：网络分层的真实含义是什么

<b> 1.网络分层的意义和我们传统软件开发的MVC目的是一样的，分层即为了解耦。</b>  
<b> 2.只要是跑在网络上的包，都是完整的。可以有下层没上层，但绝对不可能有上层没下层。</b>  
<b> 3.一包网络包从A到到B，简单说就是经历自上而下的层层装包，然后又经历了自下至上的层层拆包</b>  
<b> 4.有了IP地址为什么还要有MAC地址？</b>  
>（1）IP地址是OSI三层的地址；MAC地址是OSI二层地址。  
>（2）基于第1点，在广域网中寻址使用IP地址；在局域网中寻址使用MAC地址。  
>（3）IP地址具有定位功能；而MAC地址具有标识功能。

<br />
## 第3章：ifconfig：最熟悉又陌生的命令行

<b> 1.在Linux中，除了ifconfig以外，还可以使用另一个命令“ip addr”来查看我们的网卡信息。</b>  
<b> 2.关于IP地址</b>
> （1）我们目前使用的IPv4地址占32位，也就是4字节；目前没有推广开的IPv6地址占128位，16字节。  
> （2）一个IP地址的组成包含“类型”、“网络号”和“主机号”三部分。  
> （3）网络号：我们的IPv4地址被划分为5大类，分别用“0”、“10”、“110”、“1110”和“11110”来区分标识。  
>    <img src="chapter3-1.jpg" />
> （4）根据IP所属的类型不同，所能表达的"网络号"和“主机号”数量也是有所不同。  
>    <img src="chapter3-2.jpg" />
> &nbsp;&nbsp;&nbsp;&nbsp;补充说明：上图中只是列举了ABC三类地址，未列出的D类（224.0.0.1-239.255.255.254）地址是广播地址；而E类是保留地址。  
> （5）IPv4地址面临的问题：C类地址包含的主机数太少；而A类B类地址包含的主机数又太多，造成地址浪费。  
> （6）基于第5点提出的问题，后续有了无类型域间选路（CIDR）解决方案：通过配置子网掩码将IP地址一分为二，通过将子网掩码和IP进行“&”运算，就可以求出IP的网络号。  
> （7）基于CIDR，为了区分出广域网和局域网，又将每一类IP地址分出了私有和公有范围：
>    <img src="chapter3-3.jpg" />   
> &nbsp;&nbsp;&nbsp;&nbsp;补充说明：CIDR不是为了区分私有网络和公有网络，而是用来判断来访IP和当前LAN是否同一网段。

<b> 3.关于MAC地址</b>
> （1）MAC作为物理网卡地址，采用16进制标识，占用6字节。  
> （2）MAC地址理论上全球唯一，但实际上只能做到也必须是局域网唯一。  
<b> 4.关于网卡处理网络包的策略</b>  
> （1）默认采用fifo策略，先进先出。
> （2）fifo_fast更加复杂一些，采用3个band：band0优先级最好，band2优先级最低。如果band0有数据包，则优先处理，band1和band2稍后。
> （3）网络传过来的数据包，会进入哪个band，由IP头中的TOS字段（服务类型）记录。


## 第4章：DHCP与PXE

<b> 1.IP默认的寻址逻辑</b>
> （1）首先判断目标IP和本机IP是否同一网段  
> （2）同一个网段时，发送ARP请求，将MAC地址补充完整，然后将网络包交给交换机转发到目的地。  
> （3）如不在同一网段，则是将网络包发送至网关，由网关决定网络包的路由路径。  

<b> 2.关于DHCP协议</b>  
> 一种自动为终端分配IP的协议，即动态配置主机协议（Dynamic Host Configuration Protocal）

<b> 3.DHCP工作方式</b>  
> （1）新机器加入网络时，由于没有被分配IP，只有自身MAC地址，因此会进行“DHCP Discover”，使用UDP协议，IP地址为“0.0.0.0”来发一条“Boot Request”广播（广播地址为255.255.255.255），试图获取在LAN内IP。  
> （2）当DHCP Server收到广播后，会随即对其进行回复：也是使用UDP协议，发送一条广播，将分配好的IP告知新机器，这个步骤称之为“DHCP Offer”。  
> &nbsp;&nbsp;补充说明：虽然DHCP Server得知了新机器的MAC地址，但仍采用广播方式，我猜是因为使用UDP协议时一定要基于IP，无法直接使用MAC地址。  
> （3）新机器收到DHCP Server的答复后，会在发送一条广播，告知自己准备使用Server分配的IP地址。意图也在告知其他消息后置的Server撤销IP分配，以便提供给下一个IP租用者。  
> &nbsp;&nbsp;补充说明：此时，由于新机器还没有得到DHCP Server的最终回复，IP地址仍采用”0.0.0.0“。  
> （4）最终DHCP收到新机器的确认后，广播发送“DHCP ACK”回执，并将这组IP和MAC加入到路由配置表中，后续通讯即可通过IP发送。
  
<b> 4.关于PXE批量安装操作系统：文章只提供思路，日后需要时再实践即可。</b>  

## 第5章：从物理层到链路层
<b> 1.物理层</b>  
>（1）位居OSI模型中第一层，其作用是为网络设备之间提供联通、互联、传输。该层关心的是信号与介质，例如双绞线，同轴电缆、光纤等。二进制数据只有通过网卡先转换成正负极、强弱电、光波的闪灭来表示并传输。  
>（2）物理层设备：网线、中继器（放大信号，延长传输距离）和集线器（可以连接多台设备）  

<b> 2.链路层</b>
>（1）链路层也叫MAC层，即媒体访问控制，通过名称可大致了解OSI定义这层的目的，该层关心的是数据发送逻辑，包括检测报文完整性（CRC，通过XOR异或算法，来计算整个包是否在发送过程中出现问题）。  
>（2）链路层设备：网桥（早期2层设备，相当于一个2口的交换机），交换机。  
>（3）链路层协议：IEEE、FDDI、ATM，PPTP、MPLS、ARP协议（前3个属于1层2层协议，PPTP和MPLS都是实现VPN技术不同的协议，PPTP只在2层工作，而MPLS则在和ARP一样，属于2层3层协议）  
> &nbsp;&nbsp;待考证：在实际网络架构中，链路层采用的协议不同，也需要物理层传输介质改变，因此例如我们常见的IEEE、FDDI、ATM等协议都是跨物理层和链路层，而我们最常见的网卡设备，也是同时工作在一层和二层的设备。

<b> 3.集线器(Hub)与交换机(Switch)对比</b>  
> （1）Hub属于1层设备；Switch属于2层设备。  
> （2）Hub采用广播方式传输数据；Switch通过自我学习方式，构建转发表。  
> （3）Switch支持生成树算法，可以构建出物理有环路，而逻辑无环的网络。  

## 第6章：交换机与VLAN
<b>1.如何解决网络中的环路问题</b>  
> （1）使用最小生成树的方式，解决网络拓扑图中的环路问题。  

<b>2.关于网络拓扑图中最小生成树的问题（STP）</b>   
> （1）回顾STP算法思想：STP算法的目的是用最小代价求出最短联通路径，当联通路径求出时，也顺带解决了环路问题。  
> （2）根据IEEEE802.1D定义，每个网桥必须在每1-10秒内交换BPDU包，从而判断端口使用情况，来消除环路。  
> （3）生成树的算法和网桥设备没有任何关系，只要设备能提供生成树的算法，就可以消除环路问题。  

<b>3.如何解决广播和安全问题</b>  
> 一种解决方案就是划分出子网，将多个网络进行隔离，其中可以进行物理隔离和虚拟隔离。  
> &nbsp;（1）物理隔离：虽然实现隔离，但扩展性、灵活性较差，每次改动需要依赖硬件支持。  
> &nbsp;（2）虚拟隔离(VLAN)：虚拟局域网，工作在第二层的协议，其原理是在Mac包头上加一个Tag，附上VLAN ID，这个ID占用12位，可表示4096个网络。当交换机再转发数据包时，会先取下Mac头上的VLAN ID，判断只有相同的VLAN ID才会进行转发给自己域内的主机。而交换机之间通过Trunk口相连，这种口可以转发属于任何VLAN的数据包。  